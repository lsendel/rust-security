{{ define "security.title" }}
{{ if eq .Status "firing" }}ðŸš¨ {{ else }}âœ… {{ end }}{{ .GroupLabels.alertname }}
{{ end }}

{{ define "security.text" }}
{{ range .Alerts }}
**Alert:** {{ .Annotations.summary }}
**Service:** {{ .Labels.service }}
**Severity:** {{ .Labels.severity }}
**Category:** {{ .Labels.category }}

**Description:** {{ .Annotations.description }}

{{ if .Annotations.runbook_url }}**Runbook:** {{ .Annotations.runbook_url }}{{ end }}

**Labels:**
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: {{ .Value }}
{{ end }}

**Fired At:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .EndsAt }}**Resolved At:** {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
---
{{ end }}
{{ end }}

{{ define "security.slack.color" }}
{{ if eq .Status "firing" }}
  {{ if eq .GroupLabels.severity "critical" }}danger{{ else if eq .GroupLabels.severity "high" }}warning{{ else }}good{{ end }}
{{ else }}good{{ end }}
{{ end }}

{{ define "security.email.subject" }}
[{{ .GroupLabels.severity | upper }}] {{ if eq .Status "firing" }}ALERT{{ else }}RESOLVED{{ end }}: {{ .GroupLabels.alertname }}
{{ end }}

{{ define "security.email.body" }}
{{ if eq .Status "firing" }}
A security alert has been triggered that requires your attention.
{{ else }}
The following security alert has been resolved.
{{ end }}

{{ range .Alerts }}
Alert Name: {{ .Labels.alertname }}
Service: {{ .Labels.service }}
Severity: {{ .Labels.severity }}
Category: {{ .Labels.category }}

Summary: {{ .Annotations.summary }}
Description: {{ .Annotations.description }}

{{ if .Annotations.runbook_url }}
For detailed investigation procedures, please refer to:
{{ .Annotations.runbook_url }}
{{ end }}

Alert Details:
{{ range .Labels.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}

Timeline:
  Alert Fired: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .EndsAt }}  Alert Resolved: {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
  Duration: {{ .EndsAt.Sub .StartsAt }}{{ end }}

{{ end }}

This alert was generated by the Rust Security Workspace monitoring system.
For support, contact: security-team@company.com
{{ end }}

{{ define "security.webhook.payload" }}
{
  "status": "{{ .Status }}",
  "receiver": "{{ .Receiver }}",
  "groupKey": "{{ .GroupKey }}",
  "groupLabels": {{ .GroupLabels | toJSON }},
  "commonLabels": {{ .CommonLabels | toJSON }},
  "commonAnnotations": {{ .CommonAnnotations | toJSON }},
  "externalURL": "{{ .ExternalURL }}",
  "alerts": [
    {{ range $i, $alert := .Alerts }}
    {{ if $i }},{{ end }}
    {
      "status": "{{ $alert.Status }}",
      "labels": {{ $alert.Labels | toJSON }},
      "annotations": {{ $alert.Annotations | toJSON }},
      "startsAt": "{{ $alert.StartsAt }}",
      "endsAt": "{{ $alert.EndsAt }}",
      "generatorURL": "{{ $alert.GeneratorURL }}",
      "fingerprint": "{{ $alert.Fingerprint }}"
    }
    {{ end }}
  ]
}
{{ end }}

{{ define "pagerduty.description" }}
{{ .GroupLabels.alertname }}: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
{{ end }}

{{ define "pagerduty.details" }}
{
  "summary": "{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}",
  "description": "{{ range .Alerts }}{{ .Annotations.description }}{{ end }}",
  "service": "{{ .GroupLabels.service }}",
  "severity": "{{ .GroupLabels.severity }}",
  "category": "{{ .GroupLabels.category }}",
  "runbook_url": "{{ range .Alerts }}{{ .Annotations.runbook_url }}{{ end }}",
  "alert_count": "{{ len .Alerts }}",
  "fired_at": "{{ range .Alerts }}{{ .StartsAt }}{{ end }}"
}
{{ end }}