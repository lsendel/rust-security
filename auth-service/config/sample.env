# Auth Service Configuration
# Copy this file to .env and customize for your environment

# =============================================================================
# Server Configuration
# =============================================================================
BIND_ADDR=0.0.0.0:8080

# =============================================================================
# External Dependencies
# =============================================================================
# Redis URL for token storage and caching
REDIS_URL=redis://localhost:6379

# =============================================================================
# Client Credentials (Required)
# =============================================================================
# Format: client_id:client_secret,client2_id:client2_secret
CLIENT_CREDENTIALS=demo_client:demo_secret_12345678901234567890
# Or individual client secrets
# CLIENT_SECRET_DEMO_CLIENT=demo_secret_12345678901234567890

# =============================================================================
# OAuth/OIDC Configuration
# =============================================================================
ALLOWED_SCOPES=read,write,admin

# OAuth flow settings
OAUTH_AUTHORIZATION_CODE_TTL_SECONDS=600
OAUTH_MAX_CODES_PER_CLIENT=10
OAUTH_ENFORCE_PKCE=true
OAUTH_REQUIRE_STATE=true
OAUTH_STRICT_REDIRECT_VALIDATION=true
OAUTH_ALLOWED_REDIRECT_SCHEMES=https,http

# Redirect URI Security (Enhanced Validation)
OAUTH_ENFORCE_HTTPS=true
OAUTH_BLOCKED_DOMAINS=bit.ly,tinyurl.com,t.co,short.link
OAUTH_MAX_REDIRECT_URI_LENGTH=2048

# =============================================================================
# OIDC Providers (Optional)
# =============================================================================
# Google OIDC
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=https://your-domain.com/oauth/google/callback
GOOGLE_DISCOVERY_URL=https://accounts.google.com/.well-known/openid_configuration

# Microsoft OIDC
MICROSOFT_CLIENT_ID=your-microsoft-client-id
MICROSOFT_CLIENT_SECRET=your-microsoft-client-secret
MICROSOFT_REDIRECT_URI=https://your-domain.com/oauth/microsoft/callback
MICROSOFT_DISCOVERY_URL=https://login.microsoftonline.com/common/v2.0/.well-known/openid_configuration

# GitHub OIDC
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_REDIRECT_URI=https://your-domain.com/oauth/github/callback

# =============================================================================
# Security Configuration
# =============================================================================
# JWT Token TTLs (seconds)
JWT_ACCESS_TOKEN_TTL_SECONDS=3600
JWT_REFRESH_TOKEN_TTL_SECONDS=86400

# RSA Key Size (2048, 4096, 8192)
RSA_KEY_SIZE=2048

# Request signing for critical operations
REQUEST_SIGNING_SECRET=your-request-signing-secret-32-chars-min
REQUEST_TIMESTAMP_WINDOW_SECONDS=300

# Session management
SESSION_TTL_SECONDS=7200

# CORS origins (comma-separated)
ALLOWED_ORIGINS=https://your-frontend.com,https://admin.your-domain.com

# Request body size limit (bytes)
MAX_REQUEST_BODY_SIZE=10485760

# =============================================================================
# Rate Limiting Configuration
# =============================================================================
RATE_LIMIT_GLOBAL_PER_MINUTE=1000
RATE_LIMIT_PER_IP_PER_MINUTE=60
OAUTH_RATE_LIMIT_PER_MINUTE=20
ADMIN_RATE_LIMIT_PER_MINUTE=10

# IP filtering
ENABLE_RATE_LIMIT_BANLIST=true
ENABLE_RATE_LIMIT_ALLOWLIST=false
RATE_LIMIT_BANLIST_IPS=192.168.1.100,10.0.0.50
RATE_LIMIT_ALLOWLIST_IPS=192.168.1.200,10.0.0.100

# =============================================================================
# Monitoring & Observability
# =============================================================================
PROMETHEUS_METRICS_ENABLED=true
OPENTELEMETRY_ENABLED=false
JAEGER_ENDPOINT=http://localhost:14268/api/traces
METRICS_SCRAPE_INTERVAL_SECONDS=15

# Audit logging
SECURITY_MONITORING_ENABLED=true
AUDIT_LOGGING_ENABLED=true

# =============================================================================
# Feature Flags
# =============================================================================
FEATURE_SOAR_INTEGRATION=false
FEATURE_GOOGLE_OIDC=true
FEATURE_MICROSOFT_OIDC=true
FEATURE_GITHUB_OIDC=true
FEATURE_WEBAUTHN=true
FEATURE_SCIM_V2=true
FEATURE_ADVANCED_MFA=true
FEATURE_THREAT_DETECTION=true
FEATURE_POLICY_ENGINE=true

# =============================================================================
# SCIM Configuration
# =============================================================================
SCIM_ENABLED=true
SCIM_MAX_FILTER_LENGTH=1000
SCIM_MAX_RESULTS_PER_PAGE=100
SCIM_DEFAULT_RESULTS_PER_PAGE=20

# =============================================================================
# Backpressure Configuration
# =============================================================================
OAUTH_REQUEST_LIMIT_KB=64
SCIM_REQUEST_LIMIT_KB=512
DEFAULT_REQUEST_LIMIT_KB=32
MAX_CONCURRENT_REQUESTS=1000
MAX_CONCURRENT_PER_IP=10
REQUEST_TIMEOUT_SECS=30
LOAD_SHED_THRESHOLD=0.95

# =============================================================================
# Development/Testing Flags
# =============================================================================
TEST_MODE=0
DISABLE_RATE_LIMIT=0