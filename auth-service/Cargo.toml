[[bench]]
name = "threat_conversion_bench"
harness = false

[package]
name = "auth-service"
version = "0.1.0"
edition = "2021"
license = "MIT OR Apache-2.0"
description = "Enterprise-grade authentication service with zero-trust architecture"
authors = ["Security Team"]
keywords = ["authentication", "oauth2", "security", "zero-trust"]
categories = ["web-programming::http-server", "authentication"]
repository = "https://github.com/lsendel/rust-security"
readme = "README.md"

[lints]
workspace = true

[dependencies]
axum = { workspace = true }
tokio = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
tracing = { workspace = true }
tracing-subscriber = { workspace = true, features = ["json", "env-filter"] }
log = "0.4"
tracing-appender = "0.2"
# lazy_static = "1.4"  # Using workspace version instead
uuid = { workspace = true }
webpki-roots = { workspace = true }
thiserror = { workspace = true }
http = { workspace = true }
tower = { workspace = true }
tower-http = { workspace = true }
# bytes = { workspace = true }  # Unused - removed
anyhow = { workspace = true }
config = { workspace = true }
# dotenvy = { workspace = true }  # Unused - removed by cargo-machete
redis = { workspace = true, optional = true }
deadpool-redis = { workspace = true }
utoipa = { workspace = true }
# Swagger UI is optional; enable with `--features docs`
# utoipa-swagger-ui = { workspace = true, optional = true }  # Unused
# Security enhancements
validator = { workspace = true }
argon2 = { workspace = true }
jsonwebtoken = { workspace = true }
# RSA key generation for JWKS rotation - using latest secure version
# rsa = { workspace = true }  # Removed due to RUSTSEC-2023-0071
ed25519-dalek = { workspace = true, optional = true }
chrono = { workspace = true }
hmac = { workspace = true }
# sha1 = { workspace = true }  # Unused - removed
data-encoding = { workspace = true }
sha2 = { workspace = true }
# TLS/HTTPS support
# Secret management
async-trait = { workspace = true }
hex = { workspace = true }
rand = { workspace = true }
once_cell = { workspace = true }
base64 = { workspace = true }
constant_time_eq = { workspace = true }
# Configuration file parsing
toml = { workspace = true }
# Additional dependencies for features
futures = "0.3"
serde_yaml = { workspace = true }
# Common workspace dependency
common = { path = "../common" }
# SOAR optional dependencies
sqlx = { workspace = true, features = ["postgres", "sqlite", "runtime-tokio-native-tls", "chrono", "uuid", "json", "migrate"], default-features = false, optional = true }
handlebars = { workspace = true, optional = true }
lettre = { workspace = true, optional = true }
# tera = { workspace = true, optional = true }  # Used in disabled SOAR feature
tempfile = { workspace = true, optional = true }
# walkdir = { workspace = true, optional = true }  # Used in disabled SOAR feature
# Updated to fix protobuf vulnerability RUSTSEC-2024-0437
prometheus = { workspace = true, optional = true }
urlencoding = { workspace = true }
url = { workspace = true }
reqwest = { workspace = true }
regex = { workspace = true }
# High-performance rate limiting
dashmap = { workspace = true, optional = true }
num_cpus = { workspace = true }
# OpenTelemetry for distributed tracing
# opentelemetry = { workspace = true, features = ["metrics"], optional = true }
# opentelemetry-jaeger = { workspace = true, optional = true }
# tracing-opentelemetry = { workspace = true, optional = true }
# opentelemetry_sdk = { workspace = true, features = ["metrics"], optional = true }
# SIMD and hardware acceleration (removed due to compatibility issues)
# packed_simd_2 = { workspace = true, optional = true }
ring = { workspace = true }
zeroize = { workspace = true }
unicode-normalization = "0.1"

# Security modules dependencies
# unicode-normalization = "0.1"  # Duplicate removed

# Additional missing dependencies identified during compilation
# ipnetwork = { workspace = true }  # Unused - removed
fastrand = { workspace = true }
# opentelemetry-otlp = { workspace = true, default-features = false, features = ["http", "trace"] }
# x509-parser = { workspace = true }  # Unused - removed
rustls = { workspace = true }
# rustls-pemfile = { workspace = true }  # Unused - removed
rayon = { workspace = true }
# High-performance async runtime
# Connection pooling optimization
# deadpool-redis dependency moved to main dependencies section above
# bb8 = { workspace = true, optional = true }  # Unused - removed
# bb8-redis = { workspace = true, optional = true }  # Unused - removed
# Optimized serialization
# Metrics and profiling
# pprof2 = { workspace = true, optional = true }  # Removed due to RUSTSEC-2024-0408

# Threat Hunting and ML Dependencies
# Machine Learning and Data Analysis
# smartcore = { workspace = true, optional = true }  # Removed due to workspace dependency issue
# ndarray = { workspace = true, optional = true }  # Removed due to workspace dependency issue
# nalgebra = { workspace = true, optional = true }  # Removed due to workspace dependency issue
# Graph analysis for attack pattern detection
petgraph = { workspace = true, optional = true }
# Time series analysis
# tsc gated under target-specific dependencies below
# Statistics and analytics
# statrs = { workspace = true, optional = true }  # Removed due to workspace dependency issue
# Advanced collections for threat correlation
# indexmap = { workspace = true }  # Unused - removed by cargo-machete
# Async channels and queues
flume = { workspace = true, optional = true }
# crossbeam = { workspace = true, optional = true }  # Unused
# Geospatial analysis for location anomalies
# geo = { workspace = true, optional = true }  # Used in disabled threat-hunting feature
# geoutils = { workspace = true, optional = true }  # Used in disabled threat-hunting feature
# Enhanced time handling
time = { workspace = true, optional = true }
# Memory-mapped files for large datasets
# memmap2 = { workspace = true, optional = true }  # Used in disabled advanced-analytics feature
# Compression for data storage
# lz4_flex = { workspace = true, optional = true }  # Used in disabled advanced-analytics feature
# IP address analysis
# ipnet = { workspace = true, optional = true }  # Unused
# Enhanced string processing for log parsing
# fancy-regex = { workspace = true, optional = true }  # Unused
# aho-corasick = { workspace = true, optional = true }  # Unused
# Bloom filters for efficient lookups
# bloomfilter = { workspace = true, optional = true }  # Unused
# Probabilistic data structures
# probabilistic-collections = { workspace = true, optional = true }  # Used in disabled advanced-analytics
# Lazy static for static variables
lazy_static = { workspace = true }

# Post-Quantum Cryptography dependencies
# pqcrypto-mlkem = { workspace = true, optional = true }  # Removed due to workspace dependency issue
# pqcrypto-mldsa = { workspace = true, optional = true }  # Removed due to workspace dependency issue
# Hybrid cryptography support
p256 = { workspace = true, optional = true }
# p384 = { workspace = true, optional = true }  # Used in disabled hybrid-crypto feature
# ed25519-dalek already included above
# x25519-dalek = { workspace = true, optional = true }  # Unused
# Certificate and PKI support for post-quantum
# x509-cert = { workspace = true, optional = true }  # Unused
# pkcs8 = { workspace = true, optional = true }  # Unused
# der = { workspace = true, optional = true }  # Unused
# Performance and security utilities

vaultrs = { workspace = true, optional = true }
aws-config = { workspace = true, optional = true }
aws-sdk-secretsmanager = { workspace = true, optional = true }
# smartcore = "0.4.2"  # Commented out to reduce conflicts
# statrs = "0.18.0"    # Commented out to reduce conflicts
# nalgebra = "0.34.0"  # Commented out to reduce conflicts

[dev-dependencies]
criterion = { workspace = true }
reqwest = { workspace = true }
tokio = { workspace = true }
hmac = { workspace = true }
sha1 = { workspace = true }
serde_json = { workspace = true }
# Test dependencies
uuid = { workspace = true }
chrono = { workspace = true }
url = { workspace = true }
urlencoding = { workspace = true }
# Property-based testing
proptest = { workspace = true }
quickcheck = { workspace = true }
quickcheck_macros = { workspace = true }
# Performance testing (using workspace version)
tokio-test = { workspace = true }
# Security testing
regex = { workspace = true }
# Test utilities
tempfile = { workspace = true }
wiremock = { workspace = true }
futures = { workspace = true }
# Coverage and benchmarking in tests
# tarpaulin = "0.30"  # Commented out - not available on crates.io

[features]
# MVP-focused feature set
default = ["security-essential"]
security-essential = ["crypto", "rate-limiting"]
redis-sessions = []  # Redis dependencies are now always enabled
postgres = ["dep:sqlx"]
metrics = ["dep:prometheus"]
api-keys = ["dep:sqlx"]

# Core dependencies
crypto = ["ed25519-dalek"]
rate-limiting = ["dep:dashmap"]
monitoring = []
post-quantum = []
simd = []
vault = []
soar = []

# Build profiles are defined at workspace root

# [[bench]]
# name = "performance_suite"
# harness = false
# required-features = ["benchmarks"]  # Disabled due to pprof2 removal

[lib]
name = "auth_service"
path = "src/lib.rs"

[[bin]]
name = "auth-service"
path = "src/main.rs"

[[test]]
name = "api_key_management_it"
path = "tests/api_key_management_it.rs"
required-features = ["api-keys"]

[target.'cfg(target_arch = "x86_64")'.dependencies]
# Time series counter uses x86-specific instructions; only include on x86_64 platforms.
# tsc = { workspace = true, optional = true }  # Not a real crate, commented out
