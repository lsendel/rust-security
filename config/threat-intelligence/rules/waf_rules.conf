# WAF Rules for Rust Security Workspace
# Generated automatically from threat intelligence

# Block known malicious user agents
SecRule REQUEST_HEADERS:User-Agent "@detectSQLi" \
    "id:1001,phase:1,block,msg:'SQL Injection in User-Agent',logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"

# Block requests with suspicious patterns
SecRule ARGS "@detectSQLi" \
    "id:1002,phase:2,block,msg:'SQL Injection Attack Detected',logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"

SecRule ARGS "@detectXSS" \
    "id:1003,phase:2,block,msg:'XSS Attack Detected',logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"

# Block requests to known malicious domains
SecRule REQUEST_HEADERS:Host "@pmFromFile blocked_domains.txt" \
    "id:1004,phase:1,block,msg:'Request to blocked domain',logdata:'Domain: %{MATCHED_VAR}'"

# Rate limiting rules
SecRule IP:REQUEST_COUNT "@gt 100" \
    "id:1005,phase:1,deny,status:429,msg:'Rate limit exceeded',setvar:ip.rate_limited=1,expirevar:ip.rate_limited=300"

# Block known attack patterns
SecRule REQUEST_URI "@rx (?i)(\.\./|\.\.\\|etc/passwd|proc/self/environ)" \
    "id:1006,phase:1,block,msg:'Directory traversal attack detected'"

SecRule REQUEST_BODY "@rx (?i)(union.*select|insert.*into|delete.*from|drop.*table)" \
    "id:1007,phase:2,block,msg:'SQL injection pattern detected'"

# Custom rules based on threat intelligence
SecRule REQUEST_HEADERS:X-Forwarded-For "@ipMatchFromFile blocked_ips.txt" \
    "id:1008,phase:1,block,msg:'Request from blocked IP',logdata:'IP: %{MATCHED_VAR}'"

